optimized replacement for thread.rb primitives