Optimized replacement for thread.rb primitives